<!doctype html>
<html lang="lv">
<head>
    <meta charset="UTF-8" />
    <title>Materiālu tests</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            margin: 0;
            padding: 0;
            background: #f3f4f6;
            color: #111827;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }
        .app {
            max-width: 900px;
            width: 100%;
            padding: 16px;
        }
        .card {
            background: #ffffff;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 10px 25px rgba(15, 23, 42, 0.08);
        }
        h1 {
            text-align: center;
            margin-top: 0;
            margin-bottom: 12px;
            font-size: 1.8rem;
        }
        p.lead {
            text-align: center;
            margin-top: 0;
            margin-bottom: 20px;
            color: #4b5563;
        }
        button {
            border: none;
            border-radius: 999px;
            padding: 10px 22px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            background: #2563eb;
            color: white;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        button:disabled {
            opacity: 0.5;
            cursor: default;
        }
        .btn-secondary {
            background: #e5e7eb;
            color: #111827;
        }
        label {
            cursor: pointer;
        }
        .hidden { display: none; }

        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }
        .question-text {
            font-size: 1.2rem;
            font-weight: 600;
        }
        .progress {
            font-size: 0.95rem;
            color: #4b5563;
        }

        .sprite-wrapper {
            display: flex;
            justify-content: center;
            margin: 16px 0;
        }
        .sprite-wrapper canvas {
            border-radius: 12px;
            border: 2px solid #e5e7eb;
            background: #ffffff;
            max-width: 220px;
            width: 60vw;
            height: auto;
        }

        .options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 16px;
        }
        .option {
            border-radius: 999px;
            border: 1px solid #e5e7eb;
            padding: 8px 13px;
            display: flex;
            align-items: center;
            gap: 8px;
            background: #f9fafb;
            transition: background 0.15s, border-color 0.15s;
        }
        .option input {
            transform: scale(1.15);
            flex-shrink: 0;
        }
        .option span {
            flex: 1 1 auto;
        }

        canvas.mini-icon {
            width: 50px;
            height: 50px;
            border-radius: 4px;
            flex-shrink: 0;
        }

        .feedback {
            min-height: 24px;
            margin-bottom: 10px;
            font-weight: 600;
        }
        .feedback.ok { color: #15803d; }
        .feedback.bad { color: #b91c1c; }

        .summary {
            text-align: center;
        }
        .summary h2 {
            margin-top: 0;
            font-size: 1.5rem;
        }
        .summary p {
            margin: 4px 0;
        }

        .small {
            font-size: 0.85rem;
            color: #6b7280;
        }
    </style>
</head>
<body>
<div class="app">
    <div class="card" id="start-screen">
        <h1>Materiālu tests</h1>
        <p class="lead">Pārbaudi, no kādiem materiāliem ir izgatavoti priekšmeti un kādas ir to īpašības.</p>

        <div class="controls">
            <label>
                <input type="checkbox" id="use-all" />
                Izmantot visus jautājumus (40) vienā testā
            </label>
        </div>

        <div style="text-align:center; margin-bottom:10px;">
            <button id="start-btn">Sākt testu</button>
        </div>

        <p class="small" style="text-align:center;">
            Šeit ir jautājumi gan par <b>materiāliem</b> (plastmasa, māls, koks, stikls, gumija, metāls, audums),
            gan par to <b>īpašībām</b> (lokanums, cietība, trauslums u.c.).
        </p>
    </div>

    <div class="card hidden" id="quiz-screen">
        <div class="question-header">
            <div class="question-text" id="question-text"></div>
            <div class="progress" id="progress"></div>
        </div>

        <div class="sprite-wrapper" id="sprite-wrapper"></div>

        <form id="options-form">
            <div class="options" id="options-container"></div>
        </form>

        <div class="feedback" id="feedback"></div>

        <div class="controls">
            <button type="button" id="answer-btn">Atbildēt</button>
            <button type="button" id="restart-btn" class="btn-secondary hidden">Sākt vēlreiz</button>
        </div>

        <p class="small" id="question-hint"></p>
    </div>

    <img id="sprite-image" src="sprites.jpg" alt="" style="display:none;" />
    <img id="mini-sprite-image" src="mini-sprites.png" alt="" style="display:none;" />
</div>

<script>
    // ----- Big sprite sheet -----
    const SPRITE_COLS = 5;
    const SPRITE_ROWS = 6;

    const spriteImage = document.getElementById('sprite-image');
    let spriteReady = spriteImage.complete && spriteImage.naturalWidth > 0;
    spriteImage.addEventListener('load', () => { spriteReady = true; });

    function createSpriteCanvas(index) {
        if (!spriteReady) return null;

        const w = spriteImage.naturalWidth / SPRITE_COLS;
        const h = spriteImage.naturalHeight / SPRITE_ROWS;

        const col = index % SPRITE_COLS;
        const row = Math.floor(index / SPRITE_COLS);

        const canvas = document.createElement('canvas');
        canvas.width = w;
        canvas.height = h;

        const ctx = canvas.getContext('2d');
        ctx.imageSmoothingEnabled = true;

        ctx.drawImage(
            spriteImage,
            col * w,
            row * h,
            w,
            h,
            0,
            0,
            w,
            h
        );

        return canvas;
    }

    // ----- Mini sprite sheet -----
    const MINI_COLS = 5;
    const MINI_ROWS = 4;
    const miniSpriteImage = document.getElementById('mini-sprite-image');
    let miniReady = miniSpriteImage.complete && miniSpriteImage.naturalWidth > 0;
    miniSpriteImage.addEventListener('load', () => { miniReady = true; });

    function createMiniSpriteCanvas(index) {
        if (!miniReady) return null;

        const w = miniSpriteImage.naturalWidth / MINI_COLS;
        const h = miniSpriteImage.naturalHeight / MINI_ROWS;

        const col = index % MINI_COLS;
        const row = Math.floor(index / MINI_COLS);

        const canvas = document.createElement('canvas');
        canvas.width = w;
        canvas.height = h;

        const ctx = canvas.getContext('2d');
        ctx.imageSmoothingEnabled = true;

        ctx.drawImage(
            miniSpriteImage,
            col * w,
            row * h,
            w,
            h,
            0,
            0,
            w,
            h
        );

        canvas.classList.add('mini-icon');
        return canvas;
    }

    // ----- Mapping option text -> mini sprite index -----
    const OPTION_SPRITES = {
        // materiāli
        'plastmasa': 0,
        'māls': 1,
        'koks': 2,
        'stikls': 3,
        'gumija': 4,
        'metāls': 5,
        'audums': 6,

        // priekšmeti īpašību jautājumiem
        'nazis (metāls)': 7,
        'plastmasas ķemme': 8,
        'sūklis': 9,
        'koka dēlis': 10,
        'gumijas šļūtene': 11,
        'atlasa lente': 12,
        'gumijas bumba': 13,
        'stikla glāze': 14,
        'māla krūze': 15,
        'metāla katls': 16,
        'metāla nagla': 17,
        'koka galds': 18
    };

    // ----- Question data -----
    const MATERIALS = ['plastmasa', 'māls', 'koks', 'stikls', 'gumija', 'metāls', 'audums'];

    const QUESTIONS = [
        // 0–4: first row
        {
            id: 'bucket',
            type: 'single',
            spriteIndex: 0,
            question: 'No kāda materiāla ir izgatavots šis spainis?',
            options: shuffleArray(['plastmasa', 'metāls', 'koks', 'stikls']),
            correct: ['plastmasa'],
            hint: 'Spanis ir viegls un krāsains, nerūsē.'
        },
        {
            id: 'flower-pot',
            type: 'single',
            spriteIndex: 1,
            question: 'No kāda materiāla ir izgatavots šis puķu pods?',
            options: shuffleArray(['māls', 'plastmasa', 'koks', 'gumija']),
            correct: ['māls'],
            hint: 'Šāds pods var saplaisāt, ja nokrīt.'
        },
        {
            id: 'wooden-spoon',
            type: 'single',
            spriteIndex: 2,
            question: 'No kāda materiāla ir izgatavota šī karote?',
            options: shuffleArray(['koks', 'metāls', 'stikls', 'plastmasa']),
            correct: ['koks'],
            hint: 'To bieži izmanto gatavojot ēst katlā.'
        },
        {
            id: 'glass-cup',
            type: 'single',
            spriteIndex: 3,
            question: 'No kāda materiāla ir izgatavota šī glāze?',
            options: shuffleArray(['stikls', 'plastmasa', 'metāls', 'koks']),
            correct: ['stikls'],
            hint: 'Tā ir caurspīdīga un trausla.'
        },
        {
            id: 'rubber-ball',
            type: 'single',
            spriteIndex: 4,
            question: 'No kāda materiāla ir izgatavota šī bumba?',
            options: shuffleArray(['gumija', 'stikls', 'māls', 'koks']),
            correct: ['gumija'],
            hint: 'To var saspiest, tā labi lec.'
        },

        // 5–9: second row
        {
            id: 'metal-spoon',
            type: 'single',
            spriteIndex: 5,
            question: 'No kāda materiāla ir izgatavota šī karote?',
            options: shuffleArray(['metāls', 'plastmasa', 'koks', 'māls']),
            correct: ['metāls'],
            hint: 'Tā spīd un neuzsūc ūdeni.'
        },
        {
            id: 'tshirt',
            type: 'single',
            spriteIndex: 6,
            question: 'No kāda materiāla ir izgatavots šis T–krekls?',
            options: shuffleArray(['audums', 'plastmasa', 'metāls', 'koks']),
            correct: ['audums'],
            hint: 'To var izmazgāt un salocīt.'
        },
        {
            id: 'plastic-bottle',
            type: 'single',
            spriteIndex: 7,
            question: 'No kāda materiāla ir izgatavota šī pudele?',
            options: shuffleArray(['plastmasa', 'stikls', 'metāls', 'māls']),
            correct: ['plastmasa'],
            hint: 'Tā ir viegla un saspiežama.'
        },
        {
            id: 'clay-plate',
            type: 'single',
            spriteIndex: 8,
            question: 'No kāda materiāla ir izgatavots šis šķīvis?',
            options: shuffleArray(['māls', 'plastmasa', 'koks', 'metāls']),
            correct: ['māls'],
            hint: 'Tas ir keramikas trauks.'
        },
        {
            id: 'wooden-chair',
            type: 'single',
            spriteIndex: 9,
            question: 'No kāda materiāla galvenokārt ir izgatavots šis krēsls?',
            options: shuffleArray(['koks', 'metāls', 'plastmasa', 'gumija']),
            correct: ['koks'],
            hint: 'Līdzīgus krēslus var redzēt klasē.'
        },

        // 10–14: third row
        {
            id: 'window',
            type: 'multi',
            spriteIndex: 10,
            question: 'No kādiem materiāliem ir izgatavots šis logs?',
            options: MATERIALS,
            correct: ['koks', 'stikls'],
            hint: 'Apskati rāmi un caurspīdīgo daļu.'
        },
        {
            id: 'rubber-boots',
            type: 'single',
            spriteIndex: 11,
            question: 'No kāda materiāla ir izgatavoti gumijas zābaki?',
            options: shuffleArray(['gumija', 'audums', 'koks', 'māls']),
            correct: ['gumija'],
            hint: 'Tie neizlaiž ūdeni un ir lokani.'
        },
        {
            id: 'metal-key',
            type: 'single',
            spriteIndex: 12,
            question: 'No kāda materiāla ir izgatavota šī atslēga?',
            options: shuffleArray(['metāls', 'koks', 'plastmasa', 'māls']),
            correct: ['metāls'],
            hint: 'Tai jābūt cietai un izturīgai.'
        },
        {
            id: 'towel',
            type: 'single',
            spriteIndex: 13,
            question: 'No kāda materiāla ir izgatavots šis dvielis?',
            options: shuffleArray(['audums', 'metāls', 'stikls', 'koks']),
            correct: ['audums'],
            hint: 'Tas labi uzsūc ūdeni un ir mīksts.'
        },
        {
            id: 'toy-car',
            type: 'multi',
            spriteIndex: 14,
            question: 'No kādiem materiāliem ir izgatavota šī rotaļu mašīna?',
            options: MATERIALS,
            correct: ['plastmasa', 'gumija'],
            hint: 'Riteņi nav no tā paša materiāla kā virsbūve.'
        },

        // 15–19: fourth row
        {
            id: 'clay-mug',
            type: 'single',
            spriteIndex: 15,
            question: 'No kāda materiāla ir izgatavota šī krūze?',
            options: shuffleArray(['māls', 'plastmasa', 'stikls', 'metāls']),
            correct: ['māls'],
            hint: 'Tā ir keramikas krūze.'
        },
        {
            id: 'wooden-table',
            type: 'single',
            spriteIndex: 16,
            question: 'No kāda materiāla ir izgatavots šis galds?',
            options: shuffleArray(['koks', 'metāls', 'plastmasa', 'gumija']),
            correct: ['koks'],
            hint: 'Uz šāda galda bieži raksta skolā.'
        },
        {
            id: 'glass-jar',
            type: 'multi',
            spriteIndex: 17,
            question: 'No kādiem materiāliem ir izgatavota šī burka ar vāciņu?',
            options: MATERIALS,
            correct: ['stikls', 'plastmasa'],
            hint: 'Domā par caurspīdīgo trauku un vāciņu.'
        },
        {
            id: 'eraser',
            type: 'single',
            spriteIndex: 18,
            question: 'No kāda materiāla pārsvarā ir izgatavota šī dzēšgumija?',
            options: shuffleArray(['gumija', 'metāls', 'koks', 'stikls']),
            correct: ['gumija'],
            hint: 'Tā ir mīksta un lokana.'
        },
        {
            id: 'metal-nail',
            type: 'single',
            spriteIndex: 19,
            question: 'No kāda materiāla ir izgatavota šī nagla?',
            options: shuffleArray(['metāls', 'koks', 'plastmasa', 'gumija']),
            correct: ['metāls'],
            hint: 'Naglu sit ar āmuru kokā.'
        },

        // 20–24: fifth row (multi-material tools)
        {
            id: 'wheelbarrow',
            type: 'multi',
            spriteIndex: 20,
            question: 'No kādiem materiāliem ir izgatavota šī ķerra?',
            options: MATERIALS,
            correct: ['metāls', 'gumija'],
            hint: 'Kaste ir stingra, bet ritenis lokans.'
        },
        {
            id: 'shovel',
            type: 'multi',
            spriteIndex: 21,
            question: 'No kādiem materiāliem ir izgatavota šī lāpsta?',
            options: MATERIALS,
            correct: ['metāls', 'koks'],
            hint: 'Kāts un lāpstas daļa ir no dažādiem materiāliem.'
        },
        {
            id: 'hammer',
            type: 'multi',
            spriteIndex: 22,
            question: 'No kādiem materiāliem ir izgatavots šis āmurs?',
            options: MATERIALS,
            correct: ['metāls', 'koks'],
            hint: 'Viena daļa sit, otra daļa turas rokā.'
        },
        {
            id: 'pot',
            type: 'multi',
            spriteIndex: 23,
            question: 'No kādiem materiāliem ir izgatavots šis katls ar vāku?',
            options: MATERIALS,
            correct: ['metāls', 'stikls', 'plastmasa'],
            hint: 'Katls ir stingrs, vāks caurspīdīgs, rokturi neuzkarst tik ātri.'
        },
        {
            id: 'school-bag',
            type: 'multi',
            spriteIndex: 24,
            question: 'No kādiem materiāliem ir izgatavota šī skolas soma?',
            options: MATERIALS,
            correct: ['audums', 'plastmasa'],
            hint: 'Apskati somas audumu un sprādzes / rāvējslēdzējus.'
        },

        // 25–29: sixth row
        {
            id: 'wooden-plank',
            type: 'single',
            spriteIndex: 25,
            question: 'No kāda materiāla ir izgatavots šis dēlis?',
            options: shuffleArray(['koks', 'metāls', 'plastmasa', 'māls']),
            correct: ['koks'],
            hint: 'To var izmantot būvniecībā vai galdam.'
        },
        {
            id: 'plastic-comb',
            type: 'single',
            spriteIndex: 26,
            question: 'No kāda materiāla ir izgatavota šī ķemme?',
            options: shuffleArray(['plastmasa', 'metāls', 'koks', 'gumija']),
            correct: ['plastmasa'],
            hint: 'Tā ir viegla un nedeformējas no ūdens.'
        },
        {
            id: 'sponge',
            type: 'single',
            spriteIndex: 27,
            question: 'No kāda materiāla pārsvarā ir izgatavots šis virtuves sūklis?',
            options: shuffleArray(['plastmasa', 'māls', 'koks', 'metāls']),
            correct: ['plastmasa'],
            hint: 'Tas ir mīksts un labi uzsūc ūdeni.'
        },
        {
            id: 'rubber-hose',
            type: 'single',
            spriteIndex: 28,
            question: 'No kāda materiāla ir izgatavota šī dārza šļūtene?',
            options: shuffleArray(['gumija', 'metāls', 'koks', 'stikls']),
            correct: ['gumija'],
            hint: 'Tā ir lokana un pa to plūst ūdens.'
        },
        {
            id: 'satin-ribbon',
            type: 'single',
            spriteIndex: 29,
            question: 'No kāda materiāla ir izgatavota šī lente?',
            options: shuffleArray(['audums', 'plastmasa', 'metāls', 'koks']),
            correct: ['audums'],
            hint: 'To izmanto dāvanām un matu rotām.'
        },

        // ---- Property questions (10 pcs) ----
        {
            id: 'fragile-material',
            type: 'property',
            spriteIndex: 3,
            question: 'Kurš materiāls ir vistrauslākais – viegli saplīst, ja to nomet?',
            options: shuffleArray(['stikls', 'gumija', 'audums', 'plastmasa']),
            correct: ['stikls'],
            hint: 'Padomā par glāzi un gumijas bumbu.'
        },
        {
            id: 'flexible-hose',
            type: 'property',
            spriteIndex: 28,
            question: 'Kurš priekšmets ir vislokanākais?',
            options: shuffleArray(['gumijas šļūtene', 'koka dēlis', 'metāla nagla', 'stikla glāze']),
            correct: ['gumijas šļūtene'],
            hint: 'To var viegli saliekt, nesalaužot.'
        },
        {
            id: 'elastic-sponge',
            type: 'property',
            spriteIndex: 27,
            question: 'Kurš priekšmets pēc saspiešanas atgūst sākotnējo formu?',
            options: shuffleArray(['sūklis', 'stikla glāze', 'māla šķīvis', 'koka galds']),
            correct: ['sūklis'],
            hint: 'Tas ir elastīgs materiāls.'
        },
        {
            id: 'scratch-board',
            type: 'property',
            spriteIndex: 25,
            question: 'Ar kuru priekšmetu var visvieglāk saskrāpēt koka dēli?',
            options: shuffleArray(['nazis (metāls)', 'plastmasas ķemme', 'sūklis', 'gumijas bumba']),
            correct: ['nazis (metāls)'],
            hint: 'Cietāks materiāls var saskrāpēt mīkstāku.'
        },
        {
            id: 'heat-conduction',
            type: 'property',
            spriteIndex: 23,
            question: 'Kurš trauks paliek karsts ātrāk, ja tajā ielej karstu ūdeni?',
            options: shuffleArray(['metāla katls', 'māla krūze']),
            correct: ['metāla katls'],
            hint: 'Dažādi materiāli dažādi vada siltumu.'
        },
        {
            id: 'water-absorb',
            type: 'property',
            spriteIndex: 27,             // <-- sūklis (6. rinda, kolonna 3)
            question: 'Kurš priekšmets vislabāk uzsūc ūdeni?',
            options: shuffleArray(['sūklis', 'plastmasas pudele', 'metāla karote', 'gumijas bumba']),
            correct: ['sūklis'],
            hint: 'To izmanto trauku mazgāšanai.'
        },
        {
            id: 'rain-protection',
            type: 'property',
            spriteIndex: 11,
            question: 'Kurš priekšmets vislabāk pasargā kājas no lietus?',
            options: shuffleArray(['gumijas zābaki', 'dvielis', 'koka galds', 'māla šķīvis']),
            correct: ['gumijas zābaki'],
            hint: 'Tam jābūt necaurlaidīgam pret ūdeni.'
        },
        {
            id: 'transparent-material',
            type: 'property',
            spriteIndex: 10,
            question: 'Kurš materiāls ir caurspīdīgs, lai pa logu varētu redzēt ārā?',
            options: shuffleArray(['stikls', 'koks', 'māls', 'metāls']),
            correct: ['stikls'],
            hint: 'Rāmis nav caurspīdīgs, bet vidus gan.'
        },
        {
            id: 'soft-towel',
            type: 'property',
            spriteIndex: 13,
            question: 'Kurš materiāls parasti ir mīksts kā dvielis?',
            options: shuffleArray(['audums', 'metāls', 'stikls', 'koks']),
            correct: ['audums'],
            hint: 'No šī materiāla šuj drēbes un gultasveļu.'
        },
        {
            id: 'hard-nail',
            type: 'property',
            spriteIndex: 19,
            question: 'Kurš materiāls ir īpaši ciets un izturīgs kā nagla?',
            options: shuffleArray(['metāls', 'gumija', 'audums', 'māls']),
            correct: ['metāls'],
            hint: 'No šī materiāla gatavo instrumentus un skrūves.'
        }
    ];

    // ----- Quiz state -----
    const startScreen = document.getElementById('start-screen');
    const quizScreen = document.getElementById('quiz-screen');
    const questionTextEl = document.getElementById('question-text');
    const progressEl = document.getElementById('progress');
    const spriteWrapper = document.getElementById('sprite-wrapper');
    const optionsContainer = document.getElementById('options-container');
    const feedbackEl = document.getElementById('feedback');
    const questionHintEl = document.getElementById('question-hint');

    const startBtn = document.getElementById('start-btn');
    const answerBtn = document.getElementById('answer-btn');
    const restartBtn = document.getElementById('restart-btn');
    const useAllCheckbox = document.getElementById('use-all');

    let sessionQuestions = [];
    let currentIndex = 0;
    let correctCount = 0;
    let answered = false;

    startBtn.addEventListener('click', startQuiz);
    answerBtn.addEventListener('click', handleAnswerClick);
    restartBtn.addEventListener('click', () => {
        quizScreen.classList.add('hidden');
        startScreen.classList.remove('hidden');
    });

    function startQuiz() {
        const useAll = useAllCheckbox.checked;

        sessionQuestions = shuffleArray(QUESTIONS.slice());
        if (!useAll && sessionQuestions.length > 10) {
            sessionQuestions = sessionQuestions.slice(0, 10);
        }

        currentIndex = 0;
        correctCount = 0;
        answered = false;

        startScreen.classList.add('hidden');
        quizScreen.classList.remove('hidden');
        restartBtn.classList.add('hidden');
        answerBtn.disabled = false;
        answerBtn.textContent = 'Atbildēt';
        feedbackEl.textContent = '';
        feedbackEl.className = 'feedback';

        renderCurrentQuestion();
    }

    function renderCurrentQuestion() {
        const q = sessionQuestions[currentIndex];
        questionTextEl.textContent = q.question;
        progressEl.textContent = `Jautājums ${currentIndex + 1} / ${sessionQuestions.length}`;
        questionHintEl.textContent = '';
        feedbackEl.textContent = '';
        feedbackEl.className = 'feedback';
        answered = false;
        answerBtn.textContent = 'Atbildēt';

        // Big sprite
        spriteWrapper.innerHTML = '';
        if (q.spriteIndex != null) {
            const canvas = createSpriteCanvas(q.spriteIndex);
            if (canvas) {
                spriteWrapper.appendChild(canvas);
            }
        }

        // Options
        optionsContainer.innerHTML = '';
        const inputType = q.type === 'multi' ? 'checkbox' : 'radio';
        const name = 'answer';

        q.options.forEach((opt, idx) => {
            const id = `opt-${idx}`;
            const wrapper = document.createElement('label');
            wrapper.className = 'option';

            const input = document.createElement('input');
            input.type = inputType;
            input.name = name;
            input.value = opt;
            input.id = id;

            const span = document.createElement('span');
            span.textContent = capitalize(opt);

            wrapper.appendChild(input);

            // Add mini sprite if configured
            const spriteIdx = OPTION_SPRITES[opt];
            if (spriteIdx !== undefined) {
                const mini = createMiniSpriteCanvas(spriteIdx);
                if (mini) {
                    wrapper.appendChild(mini);
                }
            }

            wrapper.appendChild(span);
            optionsContainer.appendChild(wrapper);
        });
    }

    function handleAnswerClick() {
        if (!answered) {
            checkAnswer();
        } else {
            goNextQuestion();
        }
    }

    function getSelectedValues() {
        const inputs = optionsContainer.querySelectorAll('input');
        const selected = [];
        inputs.forEach(i => {
            if (i.checked) selected.push(i.value);
        });
        return selected;
    }

    function checkAnswer() {
        const q = sessionQuestions[currentIndex];
        const selected = getSelectedValues();

        if (selected.length === 0) {
            feedbackEl.textContent = 'Izvēlies vismaz vienu atbildi.';
            feedbackEl.className = 'feedback bad';
            return;
        }

        const correctSet = new Set(q.correct);
        const selectedSet = new Set(selected);

        let isCorrect = true;

        if (correctSet.size !== selectedSet.size) {
            isCorrect = false;
        } else {
            for (const v of correctSet) {
                if (!selectedSet.has(v)) {
                    isCorrect = false;
                    break;
                }
            }
        }

        if (isCorrect) {
            correctCount++;
            feedbackEl.textContent = 'Pareizi!';
            feedbackEl.className = 'feedback ok';
        } else {
            feedbackEl.textContent = 'Nepareizi. Pareizā atbilde: ' +
                q.correct.map(capitalize).join(', ') + '.';
            feedbackEl.className = 'feedback bad';
        }

        questionHintEl.textContent = q.hint || '';
        answered = true;

        if (currentIndex === sessionQuestions.length - 1) {
            answerBtn.textContent = 'Skatīt rezultātu';
        } else {
            answerBtn.textContent = 'Nākamais jautājums';
        }
    }

    function goNextQuestion() {
        if (currentIndex < sessionQuestions.length - 1) {
            currentIndex++;
            renderCurrentQuestion();
        } else {
            showSummary();
        }
    }

    function showSummary() {
        optionsContainer.innerHTML = '';
        spriteWrapper.innerHTML = '';
        feedbackEl.textContent = '';
        questionHintEl.textContent = '';

        const total = sessionQuestions.length;
        const percent = Math.round((correctCount / total) * 100);

        questionTextEl.textContent = 'Tests pabeigts!';
        progressEl.textContent = '';

        const summaryDiv = document.createElement('div');
        summaryDiv.className = 'summary';
        summaryDiv.innerHTML = `
      <h2>Rezultāts: ${correctCount} / ${total}</h2>
      <p>Tu atbildēji pareizi uz <b>${correctCount}</b> no <b>${total}</b> jautājumiem.</p>
      <p>Precizitāte: <b>${percent}%</b></p>
      <p class="small">Mēģini vēlreiz un salīdzini rezultātu!</p>
    `;
        optionsContainer.appendChild(summaryDiv);

        answerBtn.disabled = true;
        restartBtn.classList.remove('hidden');
    }

    // ----- Helpers -----
    function shuffleArray(arr) {
        const a = arr.slice();
        for (let i = a.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [a[i], a[j]] = [a[j], a[i]];
        }
        return a;
    }

    function capitalize(str) {
        if (!str) return str;
        return str.charAt(0).toUpperCase() + str.slice(1);
    }
</script>
</body>
</html>
